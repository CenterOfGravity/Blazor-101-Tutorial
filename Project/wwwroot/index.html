<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Project</title>
    <base href="/" />
    <link href="css/app.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <!-- If you add any scoped CSS files, uncomment the following to load them-->
    <link href="Project.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>

    <script>
        width = function () {
            return window.innerWidth;
        };

        LocalStorageSetItem = (key, item) => {
            window.localStorage.setItem(key, item);
        };

        LocalStorageGetItem = (key) => {
            return window.localStorage.getItem(key);
        };

        LocalStorageRemoveItem = (key) => {
            window.localStorage.removeItem(key);
        };
    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, signInWithEmailAndPassword, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBweY0K13TldzPKvvXGB6CQQoOCxq-vYBc",
            authDomain: "project-18395.firebaseapp.com",
            projectId: "project-18395",
            storageBucket: "project-18395.appspot.com",
            messagingSenderId: "729063269694",
            appId: "1:729063269694:web:e6b5b4141d6e319142386f"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Initialize Firebase Authentication and get a reference to the service
        const auth = getAuth(app);

        var actionCodeSettings = {
            url: 'https://localhost:7152/'
        };

        window.CreateUserWithEmailAndPassword = async function(email, password)
        {
            var IsSignedIn = false;
            await createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    IsSignedIn = true;
                    // ...
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert(errorMessage);
                    IsSignedIn = false;
                    // ..
                });
            password = "";
            return IsSignedIn;
        }

        window.SendEmailVerification = async function (ShouldSendAlert) {
            await sendEmailVerification(auth.currentUser, actionCodeSettings)
                .then(() => {
                    // Email verification sent!
                    // ...
                    if (ShouldSendAlert) {
                        alert("Verification email sent");
                    }
                }).catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    alert(errorMessage);
                    // ..
                });
        }

        window.SignInWithEmailAndPassword = async function (email, password) {
            // array[IsSignedIn --> [0], IsEmailVerified --> [1]]
            let array = [false, false];
            await signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signed in
                    const user = userCredential.user;
                    array[0] = true;
                    array[1] = user.emailVerified;
                    // ...
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    array[0] = false;
                    alert(errorMessage);
                });
            return array
        }

        window.OnAuthStateChanged = async function () {
            let name;
            await onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in, see docs for a list of available properties
                    // https://firebase.google.com/docs/reference/js/firebase.User
                    const uid = user.uid;
                    name = user.displayName
                    // ...
                } else {
                    // User is signed out
                    // ...
                    name = "";
                }
            });
            return name
        }
        window.UpdateProfile = async function (name) {
            updateProfile(auth.currentUser, {
                displayName: name
            }).then(() => {
                // Profile updated!
                // ...
            }).catch((error) => {
                // An error occurred
                alert(error);
                // ...
            });
        }
    </script>
</body>

</html>
